<!DOCTYPE html>
<html
        lang="en"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layout/index}"
>
<th:block layout:fragment="head">
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link th:href="@{/css/login.css}" rel="stylesheet"/>
</th:block>
<body>
<th:block layout:fragment="header" th:include="@{/layout/header}"></th:block>
<div layout:fragment="content" class="content">
    <div class="content_wrap">
        <div class="input_wrap">
            <label for="input_id" class="form-label">아이디</label>
            <input id="input_id" class="form-control" type="text" name='username'>
        </div>
        <div class="input_wrap">
            <label for="input_pw" class="form-label">비밀번호</label>
            <input id="input_pw" class="form-control" type="password" name='password'>
        </div>
        <div class="input_wrap">
            <input id="submit_btn" class="button_submit" name="submit" type="submit" value="로그인"/>
        </div>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const btnSubmit = document.getElementById('submit_btn');
        btnSubmit.addEventListener("click", function() {
            const inputID = document.getElementById('input_id');
            const inputPW = document.getElementById('input_pw');

            if (window.XMLHttpRequest) {
                const httpRequest = new XMLHttpRequest();
                httpRequest.open('POST', `/user/auth/login?username=${inputID.value}&password=${inputPW.value}`);
                httpRequest.send();

                httpRequest.onreadystatechange = function() {
                    if (httpRequest.readyState === XMLHttpRequest.DONE) {
                        if (httpRequest.status === 200) {
                            const responseHeader = httpRequest.getResponseHeader('Authorization');
                            if (responseHeader) {
                                document.cookie = `shoppingmall-cookie=${responseHeader}`;
                                return alert("로그인이 성공 하였습니다.");
                            }
                        }
                        alert("로그인 요청 실패했습니다.")
                    }
                }
            }
        })
    });

</script>
<th:block layout:fragment="footer" th:include="@{/layout/footer}"></th:block>
</body>
</html>