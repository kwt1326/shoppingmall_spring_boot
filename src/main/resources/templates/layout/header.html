<!DOCTYPE html>
<html
        lang="en"
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:th="http://www.thymeleaf.org"
>
<th:block layout:fragment="head">
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
    <link th:href="@{/css/layout.css}" rel="stylesheet" />
</th:block>
    <div class="header">
        <h3>관리자 페이지</h3>&nbsp;
        <h4><a id="a_login" href="/admin/login">로그인</a></h4><div>&nbsp;/&nbsp;</div>
        <h4><a href="/admin/menu">메뉴</a></h4>
        <h4></h4>
    </div>
</html>
<script>
document.addEventListener("DOMContentLoaded", function () {
    const ignorePath = ['/admin/signup', '/admin/login']
    if (window.XMLHttpRequest) {
      const httpRequest = new XMLHttpRequest();
      const cookie = document.cookie
        ?.split('; ')
        ?.find(row => row.startsWith('shoppingmall-cookie'))
        ?.split('=')[1];
      httpRequest.responseType = 'json';
      httpRequest.open('GET', '/user/auth/logging');
      httpRequest.setRequestHeader('Authorization', cookie)
      httpRequest.send();

      httpRequest.onreadystatechange = function () {
        if (httpRequest.readyState === XMLHttpRequest.DONE) {
          const response = httpRequest.response;
          if (httpRequest.status !== 200 || !response?.result) {
            if (!ignorePath.includes(window.location.pathname)) {
              alert("어드민 이용은 로그인이 필요합니다. 로그인 페이지로 이동합니다.")
              location.href = '/admin/login';
            }
          } else {
            if (ignorePath.includes(window.location.pathname)) {
              alert("이미 로그인 되어있습니다.")
              location.href = '/admin/menu';
            }
<!--            const loginLink = document.getElementById('a_login');-->
<!--            loginLink.value = "로그아웃";-->
<!--            loginLink.href = -->
          }
        }
      }
    }
});
</script>
